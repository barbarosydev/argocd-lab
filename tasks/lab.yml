version: '3'

vars:
  MINIKUBE_CPUS: '{{.LAB_MINIKUBE_CPUS | default "8"}}'
  MINIKUBE_MEMORY: '{{.LAB_MINIKUBE_MEMORY | default "16384"}}'
  MINIKUBE_DISK_SIZE: '{{.LAB_MINIKUBE_DISK_SIZE | default "40g"}}'

tasks:
  up:
    desc: "ðŸ”¬ Start minikube and deploy ArgoCD"
    silent: true
    deps:
      - task: :_check-deps
    cmds:
      - |
        ./scripts/minikube.sh start \
          --profile {{.PROFILE}} \
          --k8s-version {{.K8S_VERSION}} \
          --driver {{.MINIKUBE_DRIVER}} \
          --cpus {{.MINIKUBE_CPUS}} \
          --memory {{.MINIKUBE_MEMORY}} \
          --disk-size {{.MINIKUBE_DISK_SIZE}}
      - |
        ./scripts/argocd.sh bootstrap \
          --namespace {{.ARGOCD_NAMESPACE}} \
          --values {{.ARGO_VALUES}} \
          --port {{.ARGOCD_PORT}}

  down:
    desc: "ðŸ”¬ Stop minikube (preserves data)"
    silent: true
    cmds:
      - ./scripts/minikube.sh stop --profile {{.PROFILE}}

  nuke:
    desc: "ðŸ”¬ Delete minikube and all data"
    silent: true
    cmds:
      - ./scripts/minikube.sh delete --profile {{.PROFILE}}

  status:
    desc: "ðŸ”¬ Check lab status"
    silent: true
    cmds:
      - ./scripts/lab.sh
