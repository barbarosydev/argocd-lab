version: '3'

tasks:
  bootstrap:
    desc: "ðŸ”„ Deploy/upgrade Argo CD"
    silent: true
    deps:
      - task: :_check-cluster
    cmds:
      - ./scripts/argocd-deploy.sh --argocd-namespace {{.ARGOCD_NAMESPACE}} --argo-values {{.ARGO_VALUES}} --port {{.ARGOCD_PORT}}

  password:
    desc: "ðŸ”„ Get admin password"
    silent: true
    deps:
      - task: :_check-cluster
    cmds:
      - kubectl -n {{.ARGOCD_NAMESPACE}} get secret argocd-initial-admin-secret -o jsonpath='{.data.password}' | base64 -d && echo

  ui:
    desc: "ðŸ”„ Open UI in browser"
    silent: true
    deps:
      - task: :_check-cluster
    cmds:
      - open http://localhost:{{.ARGOCD_PORT}}

  deploy-app:
    desc: "ðŸ”„ Deploy application"
    silent: true
    deps:
      - task: :_check-cluster
    cmds:
      - ./scripts/demo-app.sh deploy --app-name {{.APP_NAME | default "demo-api"}} --profile {{.PROFILE}} {{.CLI_ARGS}}

  undeploy-app:
    desc: "ðŸ”„ Undeploy application"
    silent: true
    deps:
      - task: :_check-cluster
    cmds:
      - ./scripts/demo-app.sh undeploy --app-name {{.APP_NAME | default "demo-api"}} {{.CLI_ARGS}}
